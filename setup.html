<head>
  <title>Shareyourpaper.org</title>
</head>
<link rel="stylesheet" href="/static/oabutton_rebrand.css"> <!-- gets the new css (still also uses the old css, just overwrites where necessary) -->

<style>
  #topnav {
    display: none;
  }
  #footer {
    display: none;
  }

  .form-control {
    color:#428BCA;
    border:2px solid #428BCA;
  }

  a {
    color:#428BCA;
    font-weight:normal;
  }
  a:hover {
    color:#428BCA;
  }

  .btn-hollow-blue:hover {
    color: #ECF3FA;
  }

  p{
    padding:0;
    margin: 10px 0;
  }

  h2{
    text-align: left;
  }

  .alert-new {
    width: 100%;
    padding: 10px;
    background-color: #428BCA;
    color: white;
    text-align: center !important;
  }
  .btn-primary {
    background-color:#428BCA;
    border-color:#428BCA;
    border-radius:0px;
    color:#ffffff;
    width:49%;
    font-weight:bold;
    padding-top:10px;
    padding-bottom:10px;
  }
  .btn-primary:hover {
    background-color:#428BCA;
    border-color:#428BCA;
    color:#ffffff;
  }

</style>


<div class="alert-new">
  <div class="center-col">
    <div>
      <p style="text-align:center;">
        Shareyourpaper.org is currently in Alpha. Please <a href="" class="blue" style="color:white"><b>let us know</b></a> how setup goes.
      </p>
    </div>
  </div>
</div>


<div id="demo" class="container-fluid">

  <div id="menu" class="section">
    <div class="row">
      <div class="col-md-6 col-md-offset-1 content">
        <div id="shareyourpaper"></div>
      </div>

      <div class="col-md-4 col-md-offset-1 blue">
        <div class="blueery">
          <h2>Let’s get you set up!</h2>

          <p>
            Congrats, you already have Shareyourpaper.org partly set up! As you complete the steps below you’ll be able to customize further. It requires no coding or systems expertise and doesn’t take long.
          </p>
          <p>
            At any time you can test Shareyourpaper.org, with your settings, on the left. Nothing will be uploaded, but we’ll respond as if it did. It’ll work just like it would on your pages, although it won’t be styled to fit with your brand yet.
          </p>
          <p><b>
            Get Shareyourpaper.org working with your:
          </b></p>

          <ul class="arrowed">
            <li>
              <a class="blue view pull preview" val="10.1145/2908080.2908114" href="">
                <span class="glyphicon glyphicon-arrow-right">
              </span> Deposit Preferences</a>
            </li>
            <li>
              <a class="blue view pull preview" val="10.1145/2908080.2908114" href="">
                <span class="glyphicon glyphicon-arrow-right">
              </span> Repository</a>
            </li>
            <li>
              <a class="blue view pull preview" val="10.1145/2908080.2908114" href="#embed">
                <span class="glyphicon glyphicon-arrow-right">
              </span> Website &amp; Brand</a>
            </li>
            <li>
              <a class="blue view pull preview" val="10.1145/2908080.2908114" href="">
                <span class="glyphicon glyphicon-arrow-right">
              </span> Open Access Policy</a>
            </li>
          </ul>

            <p><b>Once set up, it's time to:</b></p>

            <ul class="arrowed">
              <li>
                <a class="blue view pull restart" href="#rollout">
                <span class="glyphicon glyphicon-arrow-right"></span> Rollout</a>
              </li>
            </ul>
            <ul class="arrowed">
            <li>
              <a class="blue view pull preview" val="10.1145/2908080.2908114" href="">
                <span class="glyphicon glyphicon-arrow-right">
              </span> Do outreach</a>
            </li>
          </ul>
            <ul class="arrowed">
              <li>
                <a class="blue view pull restart" href="https://instantill.org/leadership">
                <span class="glyphicon glyphicon-arrow-right"></span> Support Shareyourpaper.org</a>
              </li>
            </ul>

        </div>

        <div class="bluebottom">
          <p><a class="btn btn-demo-blue  save view pull" href="#general">Get Started</a></p>
          <p><a class="blue" href="/feedback#general">Feedback</a> | <a class="blue view" href="#faq">FAQ</a> | <a class="blue" href="/feedback#bug"> Report Issue</a></p>
        </div>
      </div>
    </div>
  </div>

  <div id="general" class="section">
    <div class="row">
      <div class="col-md-6 col-md-offset-1 content">

      </div>

      <div class="col-md-4 col-md-offset-1 blue">
        <div class="blueery">
          <p><a class="blue view pull" href="#menu"><span class="glyphicon glyphicon-arrow-left"></span>  Go to Menu</a></p>
          <h2>Website &amp; Brand</h2>

          <p>
            Shareyourpaper.org has lots of settings that can be changed. Here is where they'll go for now.
          </p>

        </div>
        <div class="bluebottom">
          <p><a class="btn btn-demo-blue  save view pull" href="#workflow">Save & Continue</a></p>
          <p><a class="blue" href="/feedback#general">Feedback</a> | <a class="blue view" href="#faq">FAQ</a> | <a class="blue" href="/feedback#bug"> Report Issue</a></p>
        </div>
      </div>
    </div>
  </div>

  <div id="embed" class="section">
    <div class="row">
      <div class="col-md-6 col-md-offset-1 content">

      </div>

      <div class="col-md-4 col-md-offset-1 blue">
        <div class="blueery">
          <p><a class="blue view pull" href="#menu"><span class="glyphicon glyphicon-arrow-left"></span>  Go to Menu</a></p>
          <h2>Website &amp; Brand</h2>

          <p>
            Shareyourpaper.org can be integrated onto any webpage on your website, and blend in with your brand.
          </p>
          <p>
            <!--
            To do that you can follow these simple instructions or we’ve drafted an email you can <a href="mailto:" class="light">send your developer</a>.
            -->
            To do that you can follow these simple instructions or send these to your developers.
          </p>

          <p>
            First, include the following in the source code (HTML) of your page:
          </p>
          <pre class="stickidin">
&lt;script src="{{site_url}}/static/shareyourpaper.js"&gt;&lt;/script&gt;&lt;script&gt;shareyourpaper();&lt;/script&gt;
&lt;div id="shareyourpaper"&gt;&lt;/div&gt;</pre>

        <p>You can control where the search widget gets displayed by moving:</p>
          <pre>
&lt;div id="shareyourpaper"&gt;&lt;/div&gt;</pre>

        <p>
          If you don’t think it’s styled corrected, a developer can help you. If you have one, great, if not <a href="mailto:joe@openaccessbutton.org" class="light">reach out</a>.
        </p>

        <p>You should now be good to go!</p>

        </div>
        <div class="bluebottom">
          <p><a class="btn btn-demo-blue  save view pull" href="#workflow">Save & Continue</a></p>
          <p><a class="blue" href="/feedback#general">Feedback</a> | <a class="blue view" href="#faq">FAQ</a> | <a class="blue" href="/feedback#bug"> Report Issue</a></p>
        </div>
      </div>
    </div>
  </div>

<div id="rollout" class="section">
  <div class="row">

    <div class="col-md-6 col-md-offset-1 content">

    </div>

    <div class="col-md-4 col-md-offset-1 blue">
      <div class="blueery">
      <p><a class="blue view pull" href="#menu"><span class="glyphicon glyphicon-arrow-left"></span>  Go to Menu</a></p>
      <h2>Rollout</h2>
      <p>
        Once you're all set up, and you know it's working, it's time to put Shareyourpaper.org in patron's hands.
      </p>

      <p><b>
        Have you rolled it out?
      </b></p>
      <small>
        Only click this around when you rollout Shareyourpaper.org to patrons. This helps us support you best, and understand how we're doing.
      </small>
      <p>
      <input id="live" type="checkbox" class="setting blue">
        Yes
      </p>

      <p><b>
        Activate pilot mode?
      </b></p>
      <small>
        Pilot mode makes it easy to rollout a pilot. Patrons will know why you're trying something new, be able to give feedback and go back to old way.
      </small>
      <p>
      <input id="pilot" type="checkbox" class="setting blue">
        Yes
      </p>

      <p><b>
        Can others contact you to find out about Shareyourpaper.org?
      </b></p>
      <a href="https://docs.google.com/forms/d/e/1FAIpQLSd69rj84J7kUXowrQYehimUtR1NPY1WZuyEW01Q4bTOrV8-qA/viewform?usp=sf_link" class="blue">
        Yes, sign me up!
      </p>

    </div>
    <div class="bluebottom">
      <p><a class="btn btn-hollow-blue  save pull preview" href="#">Preview & Test</a></p>
      <p><a class="btn btn-demo-blue  save view pull" href="menu">Save & Continue</a></p>
      <p><a class="blue" href="/feedback#general">Feedback</a> | <a class="blue view" href="#faq">FAQ</a> | <a class="blue" href="/feedback#bug"> Report Issue</a></p>
    </div>
  </div>
</div>
</div>

  <div id="login" class="section">
    <div class="row">
      <div class="col-md-6 col-md-offset-1 content">

      </div>

      <div class="col-md-4 col-md-offset-1 blue">
        <div class="blueery">
          <h2>Login</h2>


        <p>You need to be <a href="/account?next=/shareyourpaper/setup">logged in</a> to set up Shareyourpaper.org. It only takes a moment.</p>
          <input type="text" name="email" id="youremail" class="form-control blue" placeholder="Your email address">
          <br>
          <a id="gologin" href="/account?next=/shareyourpaper/setup" class="btn btn-demo-blue ">Login</a>
           <p>We use your email to contact you about Shareyourpaper.org, and ensure only you can access your Shareyourpaper.org settings.</p>
        </div>


        <div class="bluebottom">
          <p><a class="blue" href="/feedback#general">Feedback</a> | <a class="blue view" href="#faq">FAQ</a> | <a class="blue" href="/feedback#bug"> Report Issue</a></p>
        </div>
      </div>
    </div>
  </div>

  <div id="faq" class="section">
    <div class="row">
      <div class="col-md-6 col-md-offset-1 content">

        <h1 style="text-align:left;margin-top:25px;margin-bottom:25px;font-size:4em;">FAQ</h1>

          <p>
            This is a stub for an FAQ. It'll work just like you'd expect when we have questions.
          </p>

      </div>

      <div class="col-md-4 col-md-offset-1 blue">
        <div class="blueery">
          <p><a class="blue view pull" href="#menu"><span class="glyphicon glyphicon-arrow-left"></span>  Go to Menu</a></p>
          <h2>Not got your quesiton answered?</h2>
          <p>
            Drop <a href="mailto:Joe@openaccessbutton.org" class="blue">Joe@openaccessbutton.org</a> an email.
          </p>

          <h2>Think you've found an issue?</h2>
          <p>
            Report it <a href="/feedback#bug" class="blue">here</a>.
          </p>

        </div>

        <div class="bluebottom">
          <p><a class="btn btn-demo-blue  view" href="#menu">Go to Menu</a></p>
          <p><a class="blue" href="/feedback#general">Feedback</a> | <a class="blue view" href="#faq">FAQ</a> | <a class="blue" href="/feedback#bug"> Report Issue</a></p>
        </div>
      </div>
    </div>
  </div>


</div>




<script src="/static/shareyourpaper.js"></script>

<script>
jQuery(document).ready(function() {
  $('#topnav').remove();
  $('#footer').remove();
});
</script>

<script src="/static/shareyourpaper_ui.js"></script>

<script>
jQuery(document).ready(function() {

  if ($('#demo').height() < $(window).height()) $('#demo').css({'min-height':$(window).height()+'px'});
  $('div.blue').css({'min-height':$(window).height()+'px'});
  var diff = Math.floor(($(window).height() - $('div.content:visible').height())/4);
  $('div.content:visible').css({'padding-top':diff+'px'});

  $(document).ajaxComplete(function(e,xhr) {
    if (xhr && xhr.responseJSON && xhr.responseJSON.data && xhr.responseJSON.data.availability !== undefined) {
      _ill_response = xhr.responseJSON.data;
      $('div.content:visible').css({'padding-top':'100px'});
      $('.oabutton_ill').off();
    }
  });

  var addsubscription = function(e) {
    try {e.preventDefault(); } catch(err) {}
    if ($('.subscription').last().val() && $('.subscription_type').last().val()) {
      $('.subscription').last().clone().val('').insertBefore($('#addsubscription'));
      $('.subscription_type').last().clone().val('').insertBefore($('#addsubscription'));
    } else {
      $('.subscription').last().focus();
    }
  }
  $('body').on('click','#addsubscription',addsubscription);

  var guesssubscription = function(e) {
    if ($(this).val().indexOf('sfx.') !== -1) {
      $(this).next('.subscription_type').val('sfx');
    } else if ($(this).val().indexOf('ebscohost.') !== -1) {
      $(this).next('.subscription_type').val('eds');
    } else if ($(this).val().indexOf('serialssolutions.') !== -1) {
      $(this).next('.subscription_type').val('sfx');
    }
  }
  $('body').on('change','.subscription',guesssubscription);

  var configure = function() {
    for (var k in uc) {
      if (k === 'pilot' || k === 'live') {
        $('#'+k).prop('checked', uc[k]);
      } else if (typeof uc[k] === 'boolean') {
        $('#'+k).prop('checked', uc[k] === true);
      } else if (k === 'subscription') {
        if (typeof uc.subscription === 'string') uc.subscription = uc.subscription.split(',');
        for ( var s in uc.subscription) {
          if (parseInt(s) !== 0) addsubscription();
          if (typeof uc.subscription[s] === 'object') {
            var url = uc.subscription[s].url;
            var type = uc.subscription[s].type;
          } else {
            var url = uc.subscription[s];
            try {
              var type = uc.subscription_type[s];
            } catch(err) {
              var type = 'unknown';
            }
          }
          $('.subscription').last().val(url);
          $('.subscription_type').last().val(type);
        }
      } else if (k !== 'subscription_type') {
        $('#'+k).val(uc[k]);
      }
    }
  }

  var _preview = false;
  var save = function(e,pvw) {
    try { e.preventDefault(); } catch (err) {}
    if (e === true || pvw || $(this).attr('preview') || $(this).hasClass('preview')) _preview = $(this).attr('preview') ? $(this).attr('preview') : (pvw ? pvw : true);
    var data = {};
    $('.setting').each(function(i, obj) {
      if ( $(this).is(':checkbox') ) {
        data[$(this).attr('id')] = $(this).is(':checked');
      } else if ( $(this).hasClass('subscription') ) {
        if ($(this).val()) {
          if (data.subscription === undefined) data.subscription = [];
          data.subscription.push($(this).val())
        } else {
          $(this).remove();
        }
      } else if ( $(this).hasClass('subscription_type') ) {
        if ($(this).val()) {
          if (data['subscription_type'] === undefined) data['subscription_type'] = [];
          data['subscription_type'].push($(this).val())
        } else {
          $(this).remove();
        }
      } else if ( $(this).val() !== undefined ) {
        data[$(this).attr('id')] = $(this).val();
        if (['ill_redirect_base_url','terms','book','other'].indexOf($(this).attr('id')) !== -1 && data[$(this).attr('id')] !== '' && data[$(this).attr('id')].indexOf('http') !== 0) {
          data[$(this).attr('id')] = 'http://' + data[$(this).attr('id')];
          $(this).val(data[$(this).attr('id')]);
        }
      }
    });

    var opts = {
      url: api + '/ill/config',
      type:'POST',
      cache:false,
      processData:false,
      contentType: 'application/json',
      dataType: 'json',
      success: function(data) {
        uc = data; // returns the updated user config
        configure();
        if (_preview) {
          $('.save').hide().after('<p class="saved">Saving changes! Your preview will run shortly.</p>');
          setTimeout(function() { $('.saved').hide(); $('.save').show(); preview(undefined,_preview); }, 3000);
          _preview = false;
        } else {
          $('.save').hide().after('<p class="saved">Saving changes!</p>');
          setTimeout(function() { $('.saved').hide(); $('.save').show(); }, 4000);
        }
      },
      error: function(data) {
        $('#save').hide().after('<p class="saved">Sorry, changes could not be saved.</p>');
        setTimeout(function() { $('.saved').hide(); $('#save').show(); }, 4000);
        _preview = false;
      },
      beforeSend: function (request) { request.setRequestHeader("x-apikey", noddy.apikey); }
    }
    opts.data = JSON.stringify(data);
    if (noddy.apikey) {
      $.ajax(opts);
    } else {
      if (_preview) {
        $('.save').hide().after('<p class="saved">You need to login to save changes! Your preview will run shortly.</p>');
        setTimeout(function() { $('.saved').hide(); $('.save').show(); preview(undefined,_preview); }, 3000);
        _preview = false;
      } else {
        $('.save').hide().after('<p class="saved">You need to login to save changes!</p>');
        setTimeout(function() { $('.saved').hide(); $('.save').show(); }, 4000);
      }
    }
  }
  $('body').on('click','.save',save);

  noddy.afterLogin = function() {
    $('.promptsignup').hide();
    var uid = noddy.user.account._id;
    if ($('.stickidin').length) {
      var uid = noddy.user.account._id;
      var repstr = 'shareyourpaper({uid:"' + uid + '"';
      if (api.indexOf('dev.') !== -1) repstr += ',api:"' + api + '"';
      repstr += '})';
      $('.stickidin').html($('.stickidin').html().replace('shareyourpaper()',repstr));
    }
    if ($('.onlyyou').length) $('.onlyyou').html($('.onlyyou').html().replace('but only you ','but only you (' + noddy.user.account.profile.firstname + ') '));
    shareyourpaper({uid:uid, api:api, css: false});
    try {
      $('.email').attr('placeholder','default ' + (noddy.user.account.email ? noddy.user.account.email : noddy.user.account.emails[0].address));
    } catch(err) {}
    try {
      uc = noddy.user.account.service.openaccessbutton.ill.config;
      configure();
    } catch(err) {}
  }

  if ($('#gologin').length) $('#gologin').bind('click',function(e) {
    if ($('#youremail').val()) $(this).attr('href',$(this).attr('href').replace('?','?email='+$('#youremail').val()+'&'));
  });

  noddy.nologin = function() {
    view(undefined,'#login');
  }
  noddy.login();
});
</script>
